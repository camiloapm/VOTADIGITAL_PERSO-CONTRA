=================================================================
GUÍA RÁPIDA: CAMBIOS NECESARIOS EN LOS ARCHIVOS HTML
=================================================================

Los archivos HTML originales (index.html, admin.html, generar-qr.html) 
necesitan actualizaciones para soportar el sistema multirol.

Debido a que estos archivos son muy extensos (700+ líneas cada uno),
aquí te indico los cambios CRÍTICOS que debes hacer:

=================================================================
ARCHIVO: public/index.html
=================================================================

1. AGREGAR VARIABLES DE CONFIGURACIÓN SUPABASE
   Busca la línea donde empieza el <script> (aprox línea 208)
   
   AGREGAR AL INICIO DEL JAVASCRIPT:

   ```javascript
   // ⚠️ CONFIGURACIÓN SUPABASE
   const SUPABASE_URL = 'https://tu-proyecto.supabase.co';
   const SUPABASE_ANON_KEY = 'eyJhbGciOi...tu-anon-key';
   ```

2. ACTUALIZAR VARIABLES DE ESTADO
   Busca donde se inicializan las variables (aprox línea 211-219)
   
   CAMBIAR:
   ```javascript
   let verifiedStudent = null;
   let verifiedCode = '';
   let candidates = [];
   let selectedCandidateId = null;
   ```
   
   POR:
   ```javascript
   let verifiedStudent = null;
   let verifiedCode = '';
   let votingStatus = null;  // NUEVO
   let currentRole = null;    // NUEVO: 'personero' o 'contralor'
   let electionMode = null;   // NUEVO: 'personero', 'contralor', 'both'
   let candidates = [];
   let selectedCandidateId = null;
   ```

3. ACTUALIZAR FUNCIÓN loadStatus()
   Busca la función loadStatus() (aprox línea 287)
   
   AGREGAR después de recibir los datos:
   ```javascript
   electionMode = data.mode || 'personero';
   ```

4. ACTUALIZAR FUNCIÓN verifyCode()
   Esta es una función COMPLEJA. El cambio principal es que ahora
   debe recibir y guardar el votingStatus:

   CAMBIAR el final de la función (aprox línea 370):
   ```javascript
   // ANTES:
   verifiedStudent = data.student;
   verifiedCode = code;
   ```
   
   POR:
   ```javascript
   // NUEVO:
   verifiedStudent = data.student;
   verifiedCode = code;
   votingStatus = data.votingStatus;
   currentRole = votingStatus.next_role;
   
   // Mostrar mensaje según el modo
   if (electionMode === 'both') {
     const total = 2;
     const completed = (votingStatus.has_voted_personero ? 1 : 0) + 
                      (votingStatus.has_voted_contralor ? 1 : 0);
     const pending = total - completed;
     
     $('vote-instructions').textContent = 
       `Votación ${completed + 1} de ${total}: ${currentRole === 'personero' ? 'Personero Estudiantil' : 'Contralor Estudiantil'}`;
   } else {
     const roleName = electionMode === 'personero' ? 'Personero Estudiantil' : 'Contralor Estudiantil';
     $('vote-instructions').textContent = `Selecciona tu candidato para ${roleName}`;
   }
   ```

5. ACTUALIZAR FUNCIÓN getCandidates()
   Cambiar el endpoint para filtrar por rol:

   CAMBIAR:
   ```javascript
   const { ok, data } = await fetchJSON(`${API_URL}/get-candidates`);
   ```
   
   POR:
   ```javascript
   const { ok, data } = await fetchJSON(`${API_URL}/get-candidates?role_name=${currentRole || 'personero'}`);
   ```

6. ACTUALIZAR FUNCIÓN submitVote()
   Ahora debe enviar también el rol:

   CAMBIAR el body del fetch (aprox línea 450):
   ```javascript
   // ANTES:
   body: JSON.stringify({
     access_code: verifiedCode,
     candidate_id: selectedCandidateId
   })
   ```
   
   POR:
   ```javascript
   // NUEVO:
   body: JSON.stringify({
     access_code: verifiedCode,
     candidate_id: selectedCandidateId,
     role_name: currentRole
   })
   ```

7. ACTUALIZAR LÓGICA POST-VOTO
   Después de votar exitosamente, verificar si quedan roles pendientes:

   AGREGAR después de mostrar el mensaje de éxito (aprox línea 475):
   ```javascript
   // Si hay más roles por votar
   if (electionMode === 'both') {
     if (currentRole === 'personero' && !votingStatus.has_voted_contralor) {
       // Pasó Personero, falta Contralor
       setTimeout(() => {
         currentRole = 'contralor';
         selectedCandidateId = null;
         $('vote-instructions').textContent = 'Votación 2 de 2: Contralor Estudiantil';
         loadCandidates();
         hideAlert($('vote-alert'));
       }, 2000);
       return;
     } else if (currentRole === 'contralor' && !votingStatus.has_voted_personero) {
       // Pasó Contralor, falta Personero (caso inusual pero posible)
       setTimeout(() => {
         currentRole = 'personero';
         selectedCandidateId = null;
         $('vote-instructions').textContent = 'Votación 2 de 2: Personero Estudiantil';
         loadCandidates();
         hideAlert($('vote-alert'));
       }, 2000);
       return;
     }
   }
   
   // Si no quedan roles, mostrar mensaje final y resetear
   showAlert($('vote-alert'), 'ok', '✅ ¡Votación completada! Gracias por participar.');
   // ... resto del código de auto-reset
   ```

=================================================================
ARCHIVO: public/admin.html  
=================================================================

1. AGREGAR CONFIGURACIÓN SUPABASE
   Al inicio del JavaScript (aprox línea 150):
   
   ```javascript
   const SUPABASE_URL = 'https://tu-proyecto.supabase.co';
   const SUPABASE_ANON_KEY = 'eyJhbGciOi...';
   ```

2. AGREGAR SECCIÓN DE CONFIGURACIÓN DE MODO
   Busca la sección de "Configuración" en el HTML (aprox línea 400)
   
   AGREGAR después del selector de estado:
   
   ```html
   <div class="card">
     <h3>⚙️ Modo de Elección</h3>
     <p class="small-note">Selecciona qué cargos estarán disponibles en esta votación.</p>
     <div class="hr"></div>
     
     <div style="margin: 1rem 0;">
       <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem; background: #f8fafc; border-radius: 0.5rem; margin-bottom: 0.5rem; cursor: pointer;">
         <input type="radio" name="election-mode" value="personero" checked>
         <span style="font-weight: 600;">Solo Personero Estudiantil</span>
       </label>
       
       <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem; background: #f8fafc; border-radius: 0.5rem; margin-bottom: 0.5rem; cursor: pointer;">
         <input type="radio" name="election-mode" value="contralor">
         <span style="font-weight: 600;">Solo Contralor Estudiantil</span>
       </label>
       
       <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem; background: #f8fafc; border-radius: 0.5rem; cursor: pointer;">
         <input type="radio" name="election-mode" value="both">
         <span style="font-weight: 600;">Personero Y Contralor (Ambos)</span>
       </label>
     </div>
     
     <div id="mode-alert" class="alert" style="display:none;"></div>
   </div>
   ```

3. ACTUALIZAR FUNCIÓN openElection()
   Modificar para enviar el modo seleccionado:

   CAMBIAR:
   ```javascript
   body: JSON.stringify({ action: 'open' })
   ```
   
   POR:
   ```javascript
   const mode = document.querySelector('input[name="election-mode"]:checked')?.value || 'personero';
   body: JSON.stringify({ action: 'open', mode: mode })
   ```

4. AGREGAR SELECTOR DE ROL AL AGREGAR CANDIDATO
   En el modal de agregar candidato, agregar:

   ```html
   <div class="form-group">
     <label>Cargo</label>
     <select id="new-candidate-role" required>
       <option value="">Selecciona el cargo</option>
       <option value="personero">Personero Estudiantil</option>
       <option value="contralor">Contralor Estudiantil</option>
     </select>
   </div>
   ```

5. ACTUALIZAR FUNCIÓN addCandidate()
   Agregar el rol al crear candidato:

   ```javascript
   const role_name = $('new-candidate-role').value;
   
   // En el body del fetch:
   body: JSON.stringify({
     name: name,
     party: party,
     photo_url: photo_url,
     role_name: role_name  // NUEVO
   })
   ```

6. ACTUALIZAR TABLA DE CANDIDATOS
   Agregar columna "Cargo" en la tabla de candidatos y mostrar el rol.

7. ACTUALIZAR ESTADÍSTICAS
   Las estadísticas ahora mostrarán datos separados por cargo.
   Modificar la función loadStats() para manejar:
   - participationPersonero
   - participationContralor
   - personeroResults
   - contralorResults

=================================================================
ALTERNATIVA RECOMENDADA
=================================================================

Dado que los cambios son extensos y distribuidos en múltiples 
lugares de archivos de 700+ líneas, te recomiendo:

OPCIÓN 1: Usar los archivos originales y hacer los cambios manualmente
         siguiendo esta guía (tomará 2-3 horas)

OPCIÓN 2: Pedirme que te genere archivos HTML COMPLETOS actualizados
         (esto superaría el límite de caracteres, así que tendría
         que hacerlo en múltiples partes)

OPCIÓN 3: Te proporciono una versión simplificada pero funcional
         del sistema multirol con archivos más pequeños

¿Cuál opción prefieres?

=================================================================
NOTA IMPORTANTE
=================================================================

Los archivos en la carpeta public/ actualmente son COPIAS del 
sistema original. NO tienen las actualizaciones multirol.

Necesitarás aplicar los cambios descritos arriba O pedirme que
genere archivos completos actualizados.

=================================================================
